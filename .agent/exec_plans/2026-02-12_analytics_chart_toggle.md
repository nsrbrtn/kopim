# ExecPlan: Переключение диаграммы аналитики (круговая/столбчатая)

## Context and Orientation
- Цель: добавить в блок категорий на экране аналитики переключение между круговой диаграммой и столбчатым графиком.
- Область кода: `lib/features/analytics/presentation/analytics_screen.dart`, документация `docs/components/`.
- Контекст/ограничения: визуально в стиле текущего экрана; без изменения доменной логики агрегации.
- Риски: поведение выделения категории должно одинаково работать в обоих режимах.

## Interfaces and Dependencies
- Внешние сервисы: нет.
- Локальные зависимости: существующий `AnalyticsBarChart` и `AnalyticsDonutChart`.
- Затрагиваемые API/модули: UI аналитики вкладки категорий.

## Plan of Work
- Добавить состояние режима графика и UI-переключатель.
- Подключить `AnalyticsBarChart` с текущей логикой выделения сегментов.
- Обновить документацию компонента аналитики.

## Concrete Steps
1) Добавить enum режима и переключатель в `_TopCategoriesPageState`.
2) Реализовать условный рендер `AnalyticsDonutChart`/`AnalyticsBarChart`.
3) Обновить docs и выполнить `dart format` + `flutter analyze`.

## Validation and Acceptance
- Команды проверки:
```bash
dart format --set-exit-if-changed lib/features/analytics/presentation/analytics_screen.dart docs/components/AnalyticsDonutChart.md
flutter analyze
```
- Acceptance criteria:
  - Пользователь может переключаться между круговой и столбчатой диаграммой.
  - В обоих режимах работает выделение категории по тапу.
  - Стиль блока соответствует текущему стилю аналитики.

## Idempotence and Recovery
- Что можно безопасно перезапускать: форматирование и анализ.
- Как откатиться: удалить переключатель и условный рендер, вернуть donut-only.

## Progress
- [x] Шаг 1: Переключатель режима.
- [x] Шаг 2: Подключение `AnalyticsBarChart`.
- [x] Шаг 3: Документация и проверки.

## Surprises & Discoveries
- Для сохранения поведения навигации по периодам стрелки `SwipeHintArrows` оставлены поверх обоих режимов графика.

## Decision Log
- Переключатель размещен внутри карточки аналитики сразу под суммой секции, чтобы пользователь видел его в контексте текущего графика.
- Логика выделения категорий (`_highlightKey`) переиспользована без дублирования и для donut, и для bar.

## Outcomes & Retrospective
- Что сделано:
- Добавлен UI-переключатель режимов графика `Круг` / `Столбцы`.
- Подключен `AnalyticsBarChart` на экране аналитики с той же логикой выделения категорий.
- Проверено `flutter analyze` без ошибок.
- Что бы улучшить в следующий раз:
- Вынести переключатель и общую логику выделения в отдельный переиспользуемый компонент аналитики.
