# ExecPlan: Редизайн экрана счёта (Account Details)

## Context and Orientation
- Цель: привести экран счёта (после тапа на карточку на главной) к предоставленному образцу, используя шрифты/цвета темы и существующие UI-паттерны.
- Область кода: `lib/features/accounts/presentation/account_details_screen.dart`, виджеты списка транзакций и секции категорий, навигация из главного экрана (если потребуется правка).
- Контекст/ограничения: без захардкоженных цветов/шрифтов; иконки и фон иконок категорий — как на экране категорий; список транзакций — как на главном экране, каждая транзакция в контейнере.
- Риски: несоответствие доступным данным (график/итоги/топ категорий) или отсутствие готовых компонентов под визуал; риск лишних rebuild без `.select()`.

## Interfaces and Dependencies
- Внешние сервисы (Firebase/Analytics/Crashlytics): нет.
- Локальные зависимости (Drift, codegen): возможно потребуется build_runner при добавлении новых провайдеров/Freezed моделей.
- Затрагиваемые API/модули: аккаунты/транзакции, категории, домашний экран (только для переиспользования компонентов/паттернов).

## Plan of Work
- Уточнить требования по данным/секции (график, фильтры периода, итоги) и источники в домене.
- Спроектировать структуру экрана и сопоставить блоки с существующими компонентами (категории/транзакции/чипы).
- Реализовать UI редизайн с переиспользованием компонентов и темизации.
- Верифицировать поведение/рендеринг на узких/широких экранах.

## Concrete Steps
1) Провести инвентаризацию существующих UI-компонентов: карточки транзакций на `home_screen`, иконки категорий на экране категорий, форматтеры сумм/дат.
2) Сформировать новый layout экрана счёта: заголовок, переключатель периода (месяц/квартал/год), блок баланса и график, блок доходы/расходы/итог, топ категорий, список транзакций.
3) Реализовать секцию «Топ категорий» с теми же иконками/фонами, что на экране категорий; связать с доменными данными по категориям.
4) Заменить список транзакций на визуальный паттерн главного экрана (контейнер на каждую транзакцию), с сохранением группировки по дням.
5) Провести выравнивание отступов/типографики по теме и проверить адаптивность.

## Validation and Acceptance
- Команды проверки:
```bash
dart format --set-exit-if-changed .
flutter analyze
```
- Acceptance criteria:
  - Экран счёта визуально соответствует образцу по структуре и иерархии блоков.
  - Цвета и шрифты берутся из темы, без hardcode.
  - Иконки/фоны категорий совпадают с экраном категорий.
  - Список транзакций визуально как на главной: отдельный контейнер на транзакцию.
  - Перфоманс: без лишних rebuild, использованы `.select()` в горячих местах.

## Idempotence and Recovery
- Что можно безопасно перезапускать: `dart format`, `flutter analyze`, `build_runner` (при необходимости).
- Как откатиться/восстановиться: вернуть изменения в `account_details_screen` и новых виджетах.
- План rollback (для миграций): не требуется.

## Progress
- [x] Шаг 1: Инвентаризация компонентов.
- [x] Шаг 2: Каркас и компоновка секций.
- [x] Шаг 3: Секция топ категорий с общими стилями.
- [x] Шаг 4: Список транзакций в стиле главной.
- [x] Шаг 5: Финальная полировка и проверка.

## Surprises & Discoveries
- ...

## Decision Log
- ...

## Outcomes & Retrospective
- Что сделано:
  - Пересобран экран счёта: периоды, график баланса, итоги, топ категорий и список транзакций.
  - Добавлен FAB для добавления транзакций в текущий счёт.
  - Обновлена документация по экрану.
- Что бы улучшить в следующий раз:
  - Проверить производительность на больших объёмах транзакций.

## Definition of Done (чек-лист)

- `dart format --set-exit-if-changed .` без изменений.
- `flutter analyze` без ошибок.
- Новая логика покрыта unit-тестами и хотя бы одним widget или integration тестом (если добавлялась логика, а не только верстка).
- Нет тяжелого CPU/I/O на UI isolate.

## Regression checklist

- Riverpod: минимизированы лишние rebuild, использованы `.select()`/листовые `ConsumerWidget`.
- UI: списки оптимизированы (`itemExtent`/`prototypeItem`), форматтеры кэшированы.

## Документация

- Изменения UX → обновить `docs/components/` или `docs/logic/` с описанием поведения.
