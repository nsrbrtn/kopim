# Аналитика (Feature Analytics)

## Обзор
Модуль аналитики предоставляет пользователю визуальное представление его финансового состояния через графики распределения расходов по категориям, динамику общего баланса и сравнение денежных потоков.

## Архитектура

Фича построена по Clean Architecture:
- **Presentation**: `AnalyticsScreen` использует `TabView` для переключения между тремя основными видами:
    1. «Категории» — распределение расходов (Donut/Bar chart).
    2. «Статистика» — детализированные показатели.
    3. «История» — динамика баланса и потоков.
- **Domain**: Сущности для графиков (`AnalyticsChartItem`, `MonthlyCashflowData`, `MonthlyBalanceData`).
- **Data**: Получение и агрегация данных из Drift БД.

## Экран аналитики (AnalyticsScreen)

Ключевой экран, объединяющий фильтрацию и визуализацию.

### Фильтрация
Пользователь может фильтровать данные по:
- **Периоду**: конкретный месяц или «Все время».
- **Счетам**: выбор одного или нескольких счетов для анализа.

Состояние фильтров управляется через `AnalyticsFilterController` (Riverpod).

### Компоненты визуализации
1. **[AnalyticsDonutChart](../components/AnalyticsDonutChart.md)**: используется для отображения структуры расходов по категориям в выбранном месяце.
2. **[MonthlyCashflowBarChart](../components/MonthlyCashflowBarChartWidget.md)**: отображает доходы и расходы в сравнении.
3. **[TotalMoneyChart](../components/TotalMoneyChartWidget.md)**: показывает динамику накоплений.

## Логика агрегации данных
Данные для аналитики подготавливаются в слое `data` через специализированные DAO-запросы к Drift. Основные принципы:
- **Изоляция**: все тяжелые расчеты выполняются вне UI-изолята.
- **Кэширование**: результаты агрегации кэшируются в Riverpod-провайдерах и обновляются только при изменении соответствующих транзакций.
- **Обработка категорий**: расходы без категории или с редкими категориями могут группироваться в раздел «Прочее».
- **Иерархия категорий**: родительская категория суммирует свои транзакции и транзакции всех подкатегорий; при раскрытии показываются прямые суммы и суммы по дочерним категориям.

## Связанные файлы
- Основной экран: [`analytics_screen.dart`](file:///home/artem/StudioProjects/kopim/lib/features/analytics/presentation/analytics_screen.dart)
- Контроллер фильтров: `analytics_filter_controller.dart`
- Виджеты графиков: `lib/features/analytics/presentation/widgets/`
